{% extends 'base.html' %}
{% load json_extras %}
{% block title %}–ì–ª–∞–≤–Ω–∞—è ‚Äî LIFE BALANCE{% endblock %}

{% block extra_css %}
<!-- –®—Ä–∏—Ñ—Ç –¥–ª—è –∫–∏—Ä–∏–ª–ª–∏—Ü—ã -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Open+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
    .dashboard-section {
        background: white;
        border-radius: 16px;
        box-shadow: 0 8px 30px rgba(74, 111, 165, 0.08);
        padding: 1.5rem;
        margin-bottom: 2rem;
        border-top: 5px solid var(--primary);
        transition: var(--transition);
    }

    .dashboard-section:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 40px rgba(74, 111, 165, 0.12);
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid rgba(74, 111, 165, 0.1);
    }

    .section-title {
        font-family: 'Montserrat', sans-serif;
        font-weight: 600;
        color: var(--primary);
        margin: 0;
        font-size: 1.3rem;
    }

    .section-link {
        color: var(--primary);
        font-size: 0.95rem;
        text-decoration: none;
        display: flex;
        align-items: center;
        transition: var(--transition);
    }

    .section-link:hover {
        color: var(--secondary);
    }

    .section-link i {
        margin-left: 5px;
    }

    .welcome-card {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
        border-radius: 16px;
        color: white;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 10px 30px rgba(74, 111, 165, 0.2);
    }

    .welcome-title {
        font-family: 'Montserrat', sans-serif;
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .welcome-subtitle {
        font-size: 1.1rem;
        opacity: 0.9;
        margin-bottom: 0;
    }

    .reminder-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 0;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        transition: var(--transition);
    }

    .reminder-item:hover {
        background-color: rgba(74, 111, 165, 0.03);
        padding-left: 10px;
        padding-right: 10px;
        margin: 0 -10px;
        border-radius: 8px;
    }

    .reminder-status {
        font-size: 0.85rem;
        padding: 3px 10px;
        border-radius: 20px;
        font-weight: 500;
    }

    .reminder-status.active {
        background-color: rgba(46, 204, 113, 0.15);
        color: #27ae60;
    }

    .reminder-status.inactive {
        background-color: rgba(236, 240, 241, 0.8);
        color: #7f8c8d;
    }

    .goal-progress-card {
        background: white;
        border-radius: 12px;
        padding: 1.25rem;
        margin-bottom: 1rem;
        border-left: 4px solid var(--primary);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        transition: var(--transition);
    }

    .goal-progress-card:hover {
        transform: translateX(5px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
    }

    .goal-progress-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
    }

    .goal-title {
        font-weight: 600;
        color: #2c3e50;
        margin: 0;
        font-size: 1.05rem;
    }

    .goal-percentage {
        font-weight: 700;
        color: var(--primary);
        font-size: 1.2rem;
    }

    .progress-bar-custom {
        height: 10px;
        background-color: #ecf0f1;
        border-radius: 5px;
        overflow: hidden;
        margin-bottom: 0.5rem;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
        border-radius: 5px;
        transition: width 1s ease-in-out;
    }

    .goal-meta {
        display: flex;
        justify-content: space-between;
        font-size: 0.85rem;
        color: #7f8c8d;
    }

    .chart-container {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1rem;
    }

    .chart-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--primary);
        margin-bottom: 1rem;
        text-align: center;
    }

    .assessment-bar {
        height: 40px;
        background: linear-gradient(90deg, rgba(74, 111, 165, 0.1) 0%, rgba(74, 111, 165, 0.2) 100%);
        border-radius: 8px;
        overflow: hidden;
        position: relative;
        margin-bottom: 0.5rem;
        transition: var(--transition);
    }

    .assessment-bar:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .assessment-fill {
        height: 100%;
        border-radius: 8px;
        transition: width 1s ease-in-out;
    }

    .assessment-label {
        position: absolute;
        top: 50%;
        left: 15px;
        transform: translateY(-50%);
        font-weight: 600;
        color: white;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        z-index: 2;
    }

    .assessment-value {
        position: absolute;
        top: 50%;
        right: 15px;
        transform: translateY(-50%);
        font-weight: 700;
        color: white;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        z-index: 2;
    }

    .chart-dates {
        display: flex;
        justify-content: space-between;
        font-size: 0.75rem;
        color: #888;
        margin-top: 0.5rem;
    }

    .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: #7f8c8d;
    }

    .empty-state-icon {
        font-size: 3rem;
        color: #bdc3c7;
        margin-bottom: 1rem;
    }

    .empty-state-title {
        font-size: 1.2rem;
        margin-bottom: 0.5rem;
        color: #34495e;
    }

    .empty-state-text {
        margin-bottom: 1.5rem;
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
    }

    .dashboard-row {
        display: flex;
        flex-wrap: wrap;
        margin: 0 -10px;
    }

    .dashboard-col {
        flex: 1;
        padding: 0 10px;
        min-width: 300px;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–ª–µ—Å–∞ –∂–∏–∑–Ω–∏ */
    .history-navigation {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 15px;
        border: 1px solid #e9ecef;
    }

    .wheel-container {
        position: relative;
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
        align-items: flex-start;
        margin-bottom: 20px;
    }

    .wheel-canvas-container {
        flex: 0 0 auto;
        width: 350px;
        height: 350px;
    }

    /* –ë–ª–æ–∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (–≤—ã–Ω–µ—Å–µ–Ω –æ—Ç–¥–µ–ª—å–Ω–æ) */
    .comparison-section {
        background: white;
        border-radius: 16px;
        box-shadow: 0 8px 30px rgba(74, 111, 165, 0.08);
        padding: 1.5rem;
        margin-bottom: 2rem;
        border-top: 5px solid var(--primary);
        transition: var(--transition);
    }

    .comparison-section:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 40px rgba(74, 111, 165, 0.12);
    }

    .comparison-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid rgba(74, 111, 165, 0.1);
    }

    .comparison-title {
        font-family: 'Montserrat', sans-serif;
        font-weight: 600;
        color: var(--primary);
        margin: 0;
        font-size: 1.3rem;
    }

    .comparison-toggle {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .comparison-card {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        border: none;
        border-radius: 10px;
        margin-bottom: 10px;
        height: 100%;
    }

    .comparison-card .card-body {
        padding: 20px;
        max-height: 400px;
        overflow-y: auto;
    }

    .comparison-card .card-title {
        color: var(--primary);
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .comparison-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 15px;
        border-bottom: 1px solid #f0f0f0;
        font-size: 0.9rem;
        gap: 10px;
    }

    .comparison-item:last-child {
        border-bottom: none;
    }

    .comparison-change {
        font-weight: 600;
        padding: 6px 10px;
        border-radius: 12px;
        font-size: 0.85rem;
        min-width: 60px;
        text-align: center;
    }

    .change-positive {
        background-color: rgba(40, 167, 69, 0.15);
        color: #28a745;
        border: 1px solid rgba(40, 167, 69, 0.3);
    }

    .change-negative {
        background-color: rgba(220, 53, 69, 0.15);
        color: #dc3545;
        border: 1px solid rgba(220, 53, 69, 0.3);
    }

    .change-neutral {
        background-color: rgba(108, 117, 125, 0.15);
        color: #6c757d;
        border: 1px solid rgba(108, 117, 125, 0.3);
    }

    .sphere-change-list {
        margin-top: 15px;
    }

    .sphere-change-list h6 {
        font-size: 0.9rem;
        color: #495057;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 5px;
        font-weight: 600;
    }

    .date-badge {
        background: var(--primary);
        color: white;
        padding: 3px 10px;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 500;
        display: inline-block;
        margin-left: 8px;
    }

    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è */
    #comparisonText {
        font-size: 0.9rem;
        line-height: 1.5;
        padding: 20px;
        background: #fff;
        border: 1px solid #dee2e6;
        border-radius: 10px;
        margin-bottom: 15px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    #comparisonText .alert {
        padding: 15px 20px;
        margin-bottom: 15px;
        border-radius: 8px;
        border: none;
        background: #fff;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        border-left: 4px solid transparent;
    }

    #comparisonText .alert-success {
        border-left-color: #28a745;
    }

    #comparisonText .alert-info {
        border-left-color: #17a2b8;
    }

    #comparisonText .alert-warning {
        border-left-color: #ffc107;
    }

    #comparisonText .alert-secondary {
        border-left-color: #6c757d;
    }

    #comparisonText .alert strong {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        font-size: 1.1rem;
    }

    #comparisonText .alert small {
        font-size: 0.85rem;
        color: #6c757d;
        display: block;
        margin-top: 10px;
    }

    #comparisonText .sphere-change-list {
        margin-top: 20px;
    }

    #comparisonText .sphere-change-list h6 {
        font-size: 0.95rem;
        color: #495057;
        margin-bottom: 10px;
        font-weight: 600;
    }

    #comparisonText .comparison-item {
        padding: 12px 15px;
        border-bottom: 1px solid #e9ecef;
        background: #fff;
        border-radius: 6px;
        margin-bottom: 8px;
        transition: all 0.2s ease;
    }

    #comparisonText .comparison-item:hover {
        background: #f8f9fa;
        transform: translateX(2px);
    }

    #comparisonText .comparison-item:last-child {
        border-bottom: none;
    }

    #comparisonText .comparison-change {
        padding: 6px 10px;
        min-width: 65px;
        font-size: 0.85rem;
        font-weight: 600;
        border-radius: 4px;
    }

    .no-history-message {
        text-align: center;
        padding: 20px;
        color: #6c757d;
        width: 100%;
    }

    .no-history-message i {
        font-size: 2rem;
        margin-bottom: 10px;
        color: #adb5bd;
    }

    .export-container {
        text-align: center;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #e9ecef;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
    @media (max-width: 992px) {
        .wheel-container {
            flex-direction: column;
            align-items: center;
        }

        .comparison-stats {
            width: 100%;
            max-width: 400px;
            max-height: 350px;
        }

        .wheel-canvas-container {
            width: 320px;
            height: 320px;
        }

        .comparison-section {
            margin-top: 20px;
        }
    }

    @media (max-width: 768px) {
        .history-navigation .d-flex {
            flex-direction: column;
            gap: 10px;
        }

        .history-navigation .btn-group {
            width: 100%;
            justify-content: center;
        }

        .wheel-canvas-container {
            width: 300px;
            height: 300px;
        }

        .dashboard-col {
            min-width: 100%;
        }
    }

    @media (max-width: 576px) {
        .wheel-canvas-container {
            width: 280px;
            height: 280px;
        }

        .comparison-stats {
            max-height: 300px;
        }

        .comparison-card .card-body {
            padding: 15px;
            max-height: 280px;
        }

        #comparisonText {
            padding: 15px;
            font-size: 0.85rem;
        }
    }

    /* === –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ë–õ–û–ö–ê –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ô === */
    #recommendationsSection {
        background: #FFF8DC;
        /* —Å–≤–µ—Ç–ª–æ-–∂–µ–ª—Ç—ã–π —Ñ–æ–Ω, –∫–∞–∫ –Ω–∞ —Ñ–æ—Ç–æ */
        border: 1px solid #FFEBCD;
        /* —Ç–æ–Ω–∫–∞—è —Ä–∞–º–∫–∞ */
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        transition: var(--transition);
    }

    #recommendationsSection:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
    }

    #recommendationsSection .section-header {
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid rgba(255, 220, 170, 0.3);
        /* —Ç–æ–Ω–∫–∞—è –ª–∏–Ω–∏—è –ø–æ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º */
    }

    #recommendationsSection .section-title {
        color: #B8860B;
        /* —Ç–µ–º–Ω–æ-–∑–æ–ª–æ—Ç–æ–π —Ü–≤–µ—Ç, –∫–∞–∫ –Ω–∞ —Ñ–æ—Ç–æ */
        font-weight: 700;
        font-size: 1.3rem;
    }

    #recommendationsText {
        font-size: 0.95rem;
        line-height: 1.6;
        color: #5C4033;
        /* —Ç–µ–º–Ω–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
        padding: 1rem;
        background: #FFF8DC;
        border-radius: 8px;
    }

    #recommendationsText .recommendations-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: #B8860B;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    #recommendationsText .recommendations-title i {
        font-size: 1.2rem;
        color: #B8860B;
    }

    #recommendationsText .recommendation-item {
        margin-bottom: 1rem;
        padding: 0.75rem 0;
        border-bottom: 1px solid rgba(255, 220, 170, 0.2);
    }

    #recommendationsText .recommendation-item:last-child {
        border-bottom: none;
    }

    #recommendationsText .recommendation-item strong {
        color: #B8860B;
        font-weight: 600;
    }

    #recommendationsText .recommendation-item p {
        margin: 0.5rem 0 0 0;
        text-indent: 0;
    }

    #recommendationsText .goal-reminder {
        margin-top: 1.5rem;
        padding: 1rem;
        background: rgba(255, 220, 170, 0.2);
        border-radius: 8px;
        border-left: 4px solid #FFA500;
        font-size: 0.9rem;
        line-height: 1.5;
    }

    #recommendationsText .goal-reminder i {
        color: #FFA500;
        margin-right: 8px;
    }
</style>
{% endblock %}
{% block content %}
<div class="fade-in">
    <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
    <div class="welcome-card">
        <h1 class="welcome-title">üåü –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.name }}!</h1>
        <p class="welcome-subtitle">–≠—Ç–æ –≤–∞—à –ª–∏—á–Ω—ã–π —Ü–µ–Ω—Ç—Ä –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏. –ó–¥–µ—Å—å –≤—ã –≤–∏–¥–∏—Ç–µ –±–∞–ª–∞–Ω—Å –∂–∏–∑–Ω–∏, –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –¥–∏–Ω–∞–º–∏–∫—É
            –∏–∑–º–µ–Ω–µ–Ω–∏–π.</p>
    </div>
    <div class="dashboard-row">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="dashboard-col">
            <!-- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h2 class="section-title"><i class="bi bi-bell"></i> –ú–æ–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</h2>
                    <a href="{% url 'reminder_list' %}" class="section-link me-3">
                        –í—Å–µ <i class="bi bi-arrow-right"></i>
                    </a>
                    <a href="{% url 'create_reminder' %}" class="section-link">
                        –î–æ–±–∞–≤–∏—Ç—å <i class="bi bi-plus-circle"></i>
                    </a>
                </div>
                {% if user.reminder_set.all %}
                {% for reminder in user.reminder_set.all %}
                <div class="reminder-item">
                    <div class="d-flex align-items-center">
                        <div class="me-3">
                            {% if reminder.type == 'daily' %}
                            <i class="bi bi-calendar-day text-primary" style="font-size: 1.5rem;"></i>
                            {% elif reminder.type == 'weekly' %}
                            <i class="bi bi-calendar-week text-info" style="font-size: 1.5rem;"></i>
                            {% else %}
                            <i class="bi bi-calendar-check text-success" style="font-size: 1.5rem;"></i>
                            {% endif %}
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>{{ reminder.get_type_display }}</strong>
                                    {% if reminder.goal %}
                                    <span class="badge bg-primary ms-2">{{ reminder.goal.title }}</span>
                                    {% endif %}
                                </div>
                                <a href="{% url 'toggle_reminder' reminder.id %}" class="text-decoration-none ms-3">
                                    {% if reminder.is_enabled %}
                                    <span class="reminder-status active">
                                        <i class="bi bi-bell-fill me-1"></i>–í–∫–ª
                                    </span>
                                    {% else %}
                                    <span class="reminder-status inactive">
                                        <i class="bi bi-bell-slash me-1"></i>–í—ã–∫–ª
                                    </span>
                                    {% endif %}
                                </a>
                            </div>
                            <div class="text-muted small mt-1">
                                <i class="bi bi-clock me-1"></i>–í {{ reminder.time }}
                                {% if reminder.type == 'deadline_based' and reminder.goal %}
                                ‚Ä¢ –î–µ–¥–ª–∞–π–Ω: {{ reminder.goal.deadline|date:"d.m.Y" }}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon"><i class="bi bi-bell-slash"></i></div>
                    <h3 class="empty-state-title">–ù–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π</h3>
                    <p class="empty-state-text">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–º–æ–≥—É—Ç –≤–∞–º –Ω–µ –∑–∞–±—ã–≤–∞—Ç—å –æ –≤–∞–∂–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è—Ö –∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–π
                        —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏</p>
                    <a href="{% url 'create_reminder' %}" class="btn btn-primary">
                        <i class="bi bi-plus-circle"></i> –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
                    </a>
                </div>
                {% endif %}
            </div>
            <!-- –ö–æ–ª–µ—Å–æ –∂–∏–∑–Ω–∏ -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h2 class="section-title"><i class="bi bi-pie-chart"></i> –ö–æ–ª–µ—Å–æ –∂–∏–∑–Ω–∏</h2>
                    <a href="{% url 'assessment_history' %}" class="section-link">
                        –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è <i class="bi bi-clock-history"></i>
                    </a>
                </div>
                <p class="text-muted mb-3" id="wheelDateLabel">–í–∞—à —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å—Ñ–µ—Ä–∞–º</p>
                <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∏—Å—Ç–æ—Ä–∏–∏ -->
                {% if all_dates|length > 1 %}
                <div class="history-navigation mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2 flex-wrap gap-2">
                        <div class="d-flex align-items-center">
                            <span class="me-2"><i class="bi bi-calendar3"></i> –ò—Å—Ç–æ—Ä–∏—è:</span>
                            <select id="dateSelector" class="form-select form-select-sm" style="width: 160px;">
                                {% for date_str in all_dates %}
                                <option value="{{ date_str }}" {% if forloop.first %}selected{% endif %}>
                                    {{ date_str|slice:"8:10" }}.{{ date_str|slice:"5:7" }}.{{ date_str|slice:"0:4" }}
                                    {% if forloop.first %}(–ø–æ—Å–ª–µ–¥–Ω—è—è){% endif %}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-secondary" id="prevDate">
                                <i class="bi bi-chevron-left"></i> –†–∞–Ω–µ–µ
                            </button>
                            <button type="button" class="btn btn-outline-primary" id="todayDate">
                                –°–µ–≥–æ–¥–Ω—è
                            </button>
                            <button type="button" class="btn btn-outline-secondary" id="nextDate" disabled>
                                –ü–æ–∑–∂–µ <i class="bi bi-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <!-- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—Ü–µ–Ω–∫–æ–π -->
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="compareToggle" checked>
                        <label class="form-check-label" for="compareToggle">
                            <i class="bi bi-graph-up-arrow"></i> –°—Ä–∞–≤–Ω–∏—Ç—å —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—Ü–µ–Ω–∫–æ–π
                        </label>
                    </div>
                </div>
                {% endif %}
                <div class="wheel-container">
                    <div class="wheel-canvas-container">
                        <canvas id="lifeWheel"></canvas>
                    </div>
                </div>
                <!-- –ö–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
                <div class="export-container">
                    <button id="export-wheel-pdf" class="btn btn-outline-primary">
                        <i class="bi bi-file-earmark-pdf me-2"></i>–≠–∫—Å–ø–æ—Ä—Ç –¥–∏–∞–≥—Ä–∞–º–º—ã –≤ PDF
                    </button>
                </div>
            </div>
            <!-- üîπ –ë–õ–û–ö –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ô (—É–ª—É—á—à–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω) -->
            <div class="dashboard-section" id="recommendationsSection" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title"><i class="bi bi-lightbulb"></i> –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h2>
                </div>
                <div id="recommendationsText"></div>
            </div>
        </div>
        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="dashboard-col">
            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ü–µ–ª—è–º -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h2 class="section-title"><i class="bi bi-flag"></i> –ê–∫—Ç–∏–≤–Ω—ã–µ —Ü–µ–ª–∏</h2>
                    <a href="{% url 'goal_list' %}" class="section-link">
                        –í—Å–µ —Ü–µ–ª–∏ <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
                {% if active_goals %}
                {% for goal in active_goals %}
                <div class="goal-progress-card">
                    <div class="goal-progress-header">
                        <h3 class="goal-title">{{ goal.title }}</h3>
                        <span class="goal-percentage">{{ goal.progress }}%</span>
                    </div>
                    <div class="progress-bar-custom">
                        <div class="progress-fill" style="width: {{ goal.progress }}%"></div>
                    </div>
                    <div class="goal-meta">
                        <span><i class="bi bi-calendar"></i> {{ goal.deadline|date:"d E Y" }}</span>
                        <span><i class="bi bi-tag"></i> {{ goal.sphere.title }}</span>
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon"><i class="bi bi-flag"></i></div>
                    <h3 class="empty-state-title">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ü–µ–ª–µ–π</h3>
                    <p class="empty-state-text">–¶–µ–ª–∏ –ø—Ä–∏–¥–∞—é—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞—à–µ–º—É —Ä–∞–∑–≤–∏—Ç–∏—é –∏ –ø–æ–º–æ–≥–∞—é—Ç —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞
                        –≤–∞–∂–Ω–æ–º</p>
                    <a href="{% url 'create_goal' %}" class="btn btn-primary">
                        <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é —Ü–µ–ª—å
                    </a>
                </div>
                {% endif %}
            </div>
            <!-- –ì—Ä–∞—Ñ–∏–∫ –¥–∏–Ω–∞–º–∏–∫–∏ -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h2 class="section-title"><i class="bi bi-graph-up"></i> –î–∏–Ω–∞–º–∏–∫–∞ –æ—Ü–µ–Ω–æ–∫</h2>
                </div>
                {% if chart_series %}
                <div style="max-height: 400px; overflow-y: auto; padding-right: 10px;">
                    {% for series in chart_series %}
                    <div class="mb-4">
                        <h5 style="color: {{ series.color }}; font-weight: 600; font-size: 0.95rem;">
                            <i class="bi bi-circle-fill" style="font-size: 0.6rem; margin-right: 8px;"></i>
                            <!-- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: —è–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
                            {% with label=series.label %}
                            {{ label }}
                            {% endwith %}
                        </h5>

                        <div class="assessment-bar">
                            {% with max_val=series.data|slice:"-1"|first %}
                            <div class="assessment-fill"
                                 style="width: {% widthratio max_val 10 100 %}%; background: linear-gradient(90deg, {{ series.color }} 0%, {{ series.color }}99 100%);">

                            </div>
                            {% endwith %}
                            <div class="assessment-label">{{ series.label }}</div>
                            <div class="assessment-value">{{ series.data|slice:"-1"|first }}/10</div>
                        </div>

                        <div class="chart-dates">
                            {% for date in series.dates %}
                            <span>{{ date }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state py-4">
                    <div class="empty-state-icon"><i class="bi bi-bar-chart"></i></div>
                    <h3 class="empty-state-title">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–∏–Ω–∞–º–∏–∫–∏</h3>
                    <p class="empty-state-text">–†–µ–≥—É–ª—è—Ä–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Å—Ñ–µ—Ä –ø–æ–∫–∞–∂–µ—Ç, –∫–∞–∫ –º–µ–Ω—è–µ—Ç—Å—è –≤–∞—à –±–∞–ª–∞–Ω—Å —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º</p>
                    <a href="{% url 'sphere_list' %}" class="btn btn-primary">
                        <i class="bi bi-pie-chart"></i> –û—Ü–µ–Ω–∏—Ç—å —Å—Ñ–µ—Ä—ã
                    </a>
                </div>
                {% endif %}
            </div>

            <!-- –ë–ª–æ–∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (–≤—ã–Ω–µ—Å–µ–Ω –æ—Ç–¥–µ–ª—å–Ω–æ –ø–æ–¥ –¥–∏–Ω–∞–º–∏–∫–æ–π –æ—Ü–µ–Ω–æ–∫) -->
            <div class="comparison-section" id="comparisonSection" style="display: none;">
                <div class="comparison-header">
                    <h2 class="comparison-title"><i class="bi bi-arrow-left-right"></i> –ê–Ω–∞–ª–∏–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π</h2>
                    <div class="comparison-toggle">
                    </div>
                </div>
                <div class="comparison-card">
                    <div class="card-body">
                        <div id="comparisonText"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- html2canvas –∏ jspdf -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const lifeWheelCtx = document.getElementById('lifeWheel').getContext('2d');
        const wheelDateLabel = document.getElementById('wheelDateLabel');
        const comparisonSection = document.getElementById('comparisonSection');
        const comparisonText = document.getElementById('comparisonText');
        const recommendationsSection = document.getElementById('recommendationsSection');
        const recommendationsText = document.getElementById('recommendationsText');

        // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ - –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ
        console.log('–î–∞–Ω–Ω—ã–µ –∏–∑ Django:', {
            latestData: {{ latest_assessments| safe_json }},
        allDates: {{ all_dates| safe_json }},
        allSpheres: {{ all_spheres| safe_json }}
    });

    // –î–∞–Ω–Ω—ã–µ –∏–∑ Django
    const latestData = {{ latest_assessments| safe_json }};
    const allDataByDate = {{ all_assessments_by_date| safe_json }};
    const allDates = {{ all_dates| safe_json }};
    const allSpheres = {{ all_spheres| safe_json }};

    // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö
    if (!latestData || Object.keys(latestData).length === 0 || allDates.length === 0) {
        const canvasContainer = document.querySelector('.wheel-canvas-container');
        if (canvasContainer) {
            canvasContainer.innerHTML = `
                <div class="no-history-message">
                    <i class="bi bi-calendar-x"></i>
                    <h5>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</h5>
                    <p>–û—Ü–µ–Ω–∏—Ç–µ —Å—Ñ–µ—Ä—ã –∂–∏–∑–Ω–∏, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∫–æ–ª–µ—Å–æ –∂–∏–∑–Ω–∏ –∏ –µ–≥–æ –∏—Å—Ç–æ—Ä–∏—é</p>
                    <a href="{% url 'sphere_list' %}" class="btn btn-primary btn-sm">
                        <i class="bi bi-pie-chart"></i> –û—Ü–µ–Ω–∏—Ç—å —Å—Ñ–µ—Ä—ã
                    </a>
                </div>
            `;
        }
        return;
    }

    // –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    let currentDateIndex = 0;
    let isComparing = true;
    let currentChart = null;

    // –¶–≤–µ—Ç–∞
    const sphereColors = [
        'rgba(74, 111, 165, 0.8)',
        'rgba(107, 142, 35, 0.8)',
        'rgba(56, 178, 172, 0.8)',
        'rgba(231, 76, 60, 0.8)',
        'rgba(155, 89, 182, 0.8)',
        'rgba(241, 196, 15, 0.8)',
        'rgba(230, 126, 34, 0.8)',
        'rgba(52, 73, 94, 0.8)'
    ];

    // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã
    function updateChart(dateIndex) {
        const currentDate = allDates[dateIndex];
        const currentData = allDataByDate[currentDate] || {};
        const latestData = allDataByDate[allDates[0]] || {};

        // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        const labels = allSpheres;
        const currentValues = allSpheres.map(sphere => currentData[sphere] || 0);
        const latestValues = allSpheres.map(sphere => latestData[sphere] || 0);

        console.log('–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –¥–ª—è –¥–∞—Ç—ã:', currentDate);
        console.log('–î–∞–Ω–Ω—ã–µ:', currentData);
        console.log('Labels:', labels);
        console.log('Values:', currentValues);

        // –°–æ–∑–¥–∞–µ–º –Ω–∞–±–æ—Ä—ã –¥–∞–Ω–Ω—ã—Ö
        const datasets = [{
            label: `–û—Ü–µ–Ω–∫–∞ –Ω–∞ ${formatDate(currentDate)}`,
            data: currentValues,
            fill: true,
            backgroundColor: 'rgba(74, 111, 165, 0.2)',
            borderColor: '#4A6FA5',
            pointBackgroundColor: sphereColors.slice(0, labels.length),
            pointBorderColor: '#fff',
            pointHoverBackgroundColor: '#fff',
            pointHoverBorderColor: '#4A6FA5',
            pointRadius: 6,
            pointHoverRadius: 8,
            borderWidth: 2
        }];

        // –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏ –Ω–µ —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞
        if (isComparing && dateIndex > 0) {
            datasets.push({
                label: `–î–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è: ${formatDate(allDates[0])}`,
                data: latestValues,
                fill: false,
                borderColor: 'rgba(231, 76, 60, 0.6)',
                borderDash: [5, 5],
                pointBackgroundColor: 'rgba(231, 76, 60, 0.6)',
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: 'rgba(231, 76, 60, 0.8)',
                pointRadius: 4,
                pointHoverRadius: 6,
                borderWidth: 1
            });
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –¥–∏–∞–≥—Ä–∞–º–º—É
        if (currentChart) {
            currentChart.data.labels = labels;
            currentChart.data.datasets = datasets;
            currentChart.update();
        } else {
            try {
                currentChart = new Chart(lifeWheelCtx, {
                    type: 'radar',
                    data: {
                        labels: labels,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        scales: {
                            r: {
                                beginAtZero: true,
                                min: 0,
                                max: 10,
                                ticks: {
                                    stepSize: 2,
                                    font: {
                                        family: "'Open Sans', sans-serif"
                                    }
                                },
                                pointLabels: {
                                    font: {
                                        family: "'Montserrat', sans-serif",
                                        size: 11,
                                        weight: '500'
                                    },
                                    color: '#2c3e50'
                                },
                                grid: {
                                    color: 'rgba(0,0,0,0.05)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: {
                                        family: "'Open Sans', sans-serif",
                                        size: 12
                                    },
                                    padding: 20,
                                    boxWidth: 12
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(44, 62, 80, 0.9)',
                                titleFont: {
                                    family: "'Montserrat', sans-serif"
                                },
                                bodyFont: {
                                    family: "'Open Sans', sans-serif"
                                },
                                mode: 'index',
                                intersect: false
                            }
                        }
                    }
                });
                console.log('–î–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–∏–∞–≥—Ä–∞–º–º—ã:', error);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                const canvasContainer = document.querySelector('.wheel-canvas-container');
                if (canvasContainer) {
                    canvasContainer.innerHTML = `
                        <div class="alert alert-danger">
                            <h5>–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–∏–∞–≥—Ä–∞–º–º—ã</h5>
                            <p>${error.message}</p>
                            <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ.</p>
                        </div>
                    `;
                }
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–∫—É –¥–∞—Ç—ã
        updateDateLabel(currentDate, dateIndex);

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
        if (dateIndex > 0 && isComparing) {
            updateComparisonStats(currentData, latestData, currentDate, allDates[0]);
            comparisonSection.style.display = 'block';
            recommendationsSection.style.display = 'block';
        } else {
            comparisonSection.style.display = 'none';
            recommendationsSection.style.display = 'none';
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        updateNavigationButtons(dateIndex);
    }

    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–µ—Ç–∫–∏ –¥–∞—Ç—ã
    function updateDateLabel(dateStr, index) {
        const date = new Date(dateStr + 'T00:00:00');
        const today = new Date();
        const isToday = date.toDateString() === today.toDateString();
        let label = `–û—Ü–µ–Ω–∫–∞ –æ—Ç ${formatDate(dateStr)}`;
        if (index === 0) {
            label += ' <span class="date-badge">–ü–æ—Å–ª–µ–¥–Ω—è—è</span>';
        } else if (isToday) {
            label += ' <span class="date-badge">–°–µ–≥–æ–¥–Ω—è</span>';
        }
        wheelDateLabel.innerHTML = label;
    }

    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è ‚Äî –¢–û–ß–ù–û –ö–ê–ö –í –¢–í–û–Å–ú –ò–°–•–û–î–ù–ò–ö–ï
    function updateComparisonStats(currentData, latestData, currentDate, latestDate) {
        let totalChange = 0;
        let improvedSpheres = 0;
        let worsenedSpheres = 0;
        let unchangedSpheres = 0;
        let totalPoints = 0;

        // –°—á–∏—Ç–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ –∫–∞–∂–¥–æ–π —Å—Ñ–µ—Ä–µ
        const sphereChanges = [];
        allSpheres.forEach((sphere, index) => {
            const currentValue = currentData[sphere] || 0;
            const latestValue = latestData[sphere] || 0;
            const change = latestValue - currentValue;
            if (currentValue > 0) {
                totalChange += change;
                totalPoints++;
                if (change > 0.5) {
                    improvedSpheres++;
                } else if (change < -0.5) {
                    worsenedSpheres++;
                } else {
                    unchangedSpheres++;
                }
                sphereChanges.push({
                    sphere: sphere,
                    current: currentValue,
                    latest: latestValue,
                    change: change,
                    percentChange: currentValue > 0 ? ((change / currentValue) * 100).toFixed(1) : '0'
                });
            }
        });

        // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è ‚Äî –¢–û–ß–ù–û –ö–ê–ö –í –¢–í–û–Å–ú –ò–°–•–û–î–ù–ò–ö–ï
        let comparisonHTML = '';
        const avgChange = totalPoints > 0 ? (totalChange / totalPoints).toFixed(1) : 0;
        if (avgChange > 0.5) {
            comparisonHTML = `
                <div class="alert alert-success">
                    <i class="bi bi-arrow-up-circle"></i>
                    <strong class="d-block ms-3">–û—Ç–ª–∏—á–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å!</strong>
                    <div class="ms-3">–ü–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å ${formatDate(currentDate)} –≤–∞—à–µ –∫–æ–ª–µ—Å–æ –∂–∏–∑–Ω–∏ —Å—Ç–∞–ª–æ –±–æ–ª–µ–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º.</div>
                </div>
                <div class="mt-2">
                    <small>
                        <i class="bi bi-check-circle"></i> –£–ª—É—á—à–µ–Ω–æ —Å—Ñ–µ—Ä: ${improvedSpheres}<br>
                        <i class="bi bi-dash-circle"></i> –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${unchangedSpheres}<br>
                        <i class="bi bi-exclamation-circle"></i> –°–Ω–∏–∑–∏–ª–æ—Å—å: ${worsenedSpheres}
                    </small>
                </div>
            `;
        } else if (avgChange > 0.1) {
            comparisonHTML = `
                <div class="alert alert-info">
                    <i class="bi bi-arrow-up-right"></i>
                    <strong class="d-block ms-2">–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞!</strong>
                    <div class="ms-2">–ù–µ–±–æ–ª—å—à–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å ${formatDate(currentDate)}.</div>
                </div>
                <div class="mt-2">
                    <small>
                        <i class="bi bi-check-circle"></i> –£–ª—É—á—à–µ–Ω–æ —Å—Ñ–µ—Ä: ${improvedSpheres}<br>
                        <i class="bi bi-dash-circle"></i> –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${unchangedSpheres}<br>
                        <i class="bi bi-exclamation-circle"></i> –°–Ω–∏–∑–∏–ª–æ—Å—å: ${worsenedSpheres}
                    </small>
                </div>
            `;
        } else if (avgChange < -0.5) {
            comparisonHTML = `
                <div class="alert alert-warning">
                    <i class="bi bi-arrow-down-circle"></i>
                    <strong class="d-block ms-2">–í–Ω–∏–º–∞–Ω–∏–µ –∫ –±–∞–ª–∞–Ω—Å—É!</strong>
                    <div class="ms-2">–ü–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å ${formatDate(currentDate)} –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å—Ñ–µ—Ä—ã —Ç—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è.</div>
                </div>
                <div class="mt-2">
                    <small>
                        <i class="bi bi-check-circle"></i> –£–ª—É—á—à–µ–Ω–æ —Å—Ñ–µ—Ä: ${improvedSpheres}<br>
                        <i class="bi bi-dash-circle"></i> –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${unchangedSpheres}<br>
                        <i class="bi bi-exclamation-circle"></i> –°–Ω–∏–∑–∏–ª–æ—Å—å: ${worsenedSpheres}
                    </small>
                </div>
            `;
        } else {
            comparisonHTML = `
                <div class="alert alert-secondary">
                    <i class="bi bi-dash-circle"></i>
                    <strong class="d-block ms-2">–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å</strong>
                    <div class="ms-2">–í–∞—à–µ –∫–æ–ª–µ—Å–æ –∂–∏–∑–Ω–∏ –æ—Å—Ç–∞–ª–æ—Å—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∏–º –∂–µ, –∫–∞–∫ –∏ ${formatDate(currentDate)}.</div>
                </div>
                <div class="mt-2">
                    <small>
                        <i class="bi bi-check-circle"></i> –£–ª—É—á—à–µ–Ω–æ —Å—Ñ–µ—Ä: ${improvedSpheres}<br>
                        <i class="bi bi-dash-circle"></i> –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ${unchangedSpheres}<br>
                        <i class="bi bi-exclamation-circle"></i> –°–Ω–∏–∑–∏–ª–æ—Å—å: ${worsenedSpheres}
                    </small>
                </div>
            `;
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ —Å—Ñ–µ—Ä–∞–º ‚Äî –¢–û–ß–ù–û –ö–ê–ö –í –¢–í–û–Å–ú –ò–°–•–û–î–ù–ò–ö–ï
        comparisonHTML += `
            <div class="sphere-change-list">
                <h6><i class="bi bi-list-ul"></i> –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ —Å—Ñ–µ—Ä–∞–º:</h6>
        `;
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤–µ–ª–∏—á–∏–Ω–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
        sphereChanges.sort((a, b) => Math.abs(b.change) - Math.abs(a.change));
        sphereChanges.slice(0, 5).forEach(item => {
            const changeClass = item.change > 0.5 ? 'change-positive' :
                item.change < -0.5 ? 'change-negative' : 'change-neutral';
            const changeIcon = item.change > 0.5 ? '‚Üë' :
                item.change < -0.5 ? '‚Üì' : '‚Üí';
            const changeSign = item.change > 0 ? '+' : '';
            comparisonHTML += `
                <div class="comparison-item">
                    <span style="flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                        ${item.sphere}
                    </span>
                    <span class="${changeClass}">
                        ${changeIcon} ${changeSign}${item.change.toFixed(1)}
                    </span>
                </div>
            `;
        });
        comparisonHTML += `</div>`;
        comparisonText.innerHTML = comparisonHTML;

        // === –ë–ª–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π ===
        let recommendationsHTML = '';
        const goalReminder = `<div class="goal-reminder">
            <i class="bi bi-flag"></i> –ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Å–µ–±–µ —Ü–µ–ª—å –¥–ª—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–ª–∏ —É–ª—É—á—à–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ ‚Äî —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å –≤ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è!
        </div>`;
        if (avgChange > 0.5) {
            recommendationsHTML = `
                <div class="recommendations-title">
                    <i class="bi bi-trophy"></i> –í—ã –º–æ–ª–æ–¥–µ—Ü!
                </div>
                <p>–í–∞—à–∞ —Ä–µ–≥—É–ª—è—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ —Å–æ–±–æ–π –ø—Ä–∏–Ω–æ—Å–∏—Ç –ø–ª–æ–¥—ã. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ ‚Äî –≤—ã —Å–æ–∑–¥–∞—ë—Ç–µ –ø—Ä–æ—á–Ω—ã–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è –≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ–π –∂–∏–∑–Ω–∏.</p>
                ${goalReminder}
            `;
        } else if (avgChange < -0.5) {
            const problematicSpheres = sphereChanges
                .filter(item => item.change < -1 || item.latest <= 4)
                .sort((a, b) => a.change - b.change)
                .slice(0, 3);
            if (problematicSpheres.length > 0) {
                recommendationsHTML += `<div class="recommendations-title">
                    <i class="bi bi-exclamation-triangle"></i> –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é:
                </div>`;
                const adviceMap = {
                    '–ó–¥–æ—Ä–æ–≤—å–µ': '–£–¥–µ–ª–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, —Å–Ω—É –∏ –ø–∏—Ç–∞–Ω–∏—é. –î–∞–∂–µ 20 –º–∏–Ω—É—Ç —Ö–æ–¥—å–±—ã –≤ –¥–µ–Ω—å –º–æ–≥—É—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏—Ç—å —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ.',
                    '–ö–∞—Ä—å–µ—Ä–∞': '–ü–µ—Ä–µ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–≤–æ–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ü–µ–ª–∏. –í–æ–∑–º–æ–∂–Ω–æ, —Å—Ç–æ–∏—Ç –æ–±—Å—É–¥–∏—Ç—å —Ä–∞–∑–≤–∏—Ç–∏–µ —Å —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–º –∏–ª–∏ –ø—Ä–æ–π—Ç–∏ –æ–±—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–º—É –Ω–∞–≤—ã–∫—É.',
                    '–§–∏–Ω–∞–Ω—Å—ã': '–°–æ—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–æ—Å—Ç–æ–π –±—é–¥–∂–µ—Ç –∏–ª–∏ –Ω–∞—á–Ω–∏—Ç–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å –¥–∞–∂–µ –Ω–µ–±–æ–ª—å—à—É—é —Å—É–º–º—É. –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∏–∂–∞–µ—Ç —Å—Ç—Ä–µ—Å—Å.',
                    '–û—Ç–Ω–æ—à–µ–Ω–∏—è': '–í—ã–¥–µ–ª–∏—Ç–µ –≤—Ä–µ–º—è –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ –æ–±—â–µ–Ω–∏—è —Å –±–ª–∏–∑–∫–∏–º–∏. –ò–Ω–æ–≥–¥–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–¥–Ω–æ–≥–æ –∏—Å–∫—Ä–µ–Ω–Ω–µ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –≤ –Ω–µ–¥–µ–ª—é.',
                    '–õ–∏—á–Ω–æ—Å—Ç–Ω—ã–π —Ä–æ—Å—Ç': '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–∏—Ç–∞—Ç—å, –≤–µ—Å—Ç–∏ –¥–Ω–µ–≤–Ω–∏–∫ –∏–ª–∏ –∏–∑—É—á–∞—Ç—å —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ. –†–æ—Å—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –º–∞–ª–µ–Ω—å–∫–∏—Ö —à–∞–≥–æ–≤.',
                    '–î—É—Ö–æ–≤–Ω–æ—Å—Ç—å': '–ù–∞–π–¥–∏—Ç–µ –≤—Ä–µ–º—è –¥–ª—è —Ç–∏—à–∏–Ω—ã ‚Äî –º–µ–¥–∏—Ç–∞—Ü–∏—è, –ø—Ä–æ–≥—É–ª–∫–∞ –Ω–∞ –ø—Ä–∏—Ä–æ–¥–µ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ 10 –º–∏–Ω—É—Ç –±–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–º–æ–≥—É—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–∞–ª–∞–Ω—Å.',
                    '–î–æ—Å—É–≥': '–†–∞–∑—Ä–µ—à–∏—Ç–µ —Å–µ–±–µ –æ—Ç–¥—ã—Ö –±–µ–∑ —á—É–≤—Å—Ç–≤–∞ –≤–∏–Ω—ã. –•–æ–±–±–∏ –∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è ‚Äî –Ω–µ —Ä–æ—Å–∫–æ—à—å, –∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏.',
                    '–û–∫—Ä—É–∂–µ–Ω–∏–µ': '–û—Ü–µ–Ω–∏—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ –≤–∞—à–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –≤–∞—Å. –ò–Ω–æ–≥–¥–∞ –Ω–µ–±–æ–ª—å—à–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ä–µ–¥–µ –¥–∞—é—Ç –±–æ–ª—å—à–æ–π —ç—Ñ—Ñ–µ–∫—Ç.'
                };
                problematicSpheres.forEach(item => {
                    const advice = adviceMap[item.sphere] || '–£–¥–µ–ª–∏—Ç–µ —ç—Ç–æ–π —Å—Ñ–µ—Ä–µ –Ω–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ –≤–Ω–∏–º–∞–Ω–∏—è –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.';
                    recommendationsHTML += `
                        <div class="recommendation-item">
                            <strong>${item.sphere}:</strong>
                            <p>${advice}</p>
                        </div>
                    `;
                });
                recommendationsHTML += `${goalReminder}`;
            } else {
                recommendationsHTML = `
                    <div class="recommendations-title">
                        <i class="bi bi-exclamation-triangle"></i> –í–Ω–∏–º–∞–Ω–∏–µ!
                    </div>
                    <p>–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Å—Ñ–µ—Ä—ã —Å –æ—Ü–µ–Ω–∫–æ–π –Ω–∏–∂–µ 5. –î–∞–∂–µ –Ω–µ–±–æ–ª—å—à–∏–µ —à–∞–≥–∏ –º–æ–≥—É—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏—Ç—å –≤–∞—à –±–∞–ª–∞–Ω—Å.</p>
                    ${goalReminder}
                `;
            }
        } else {
            recommendationsHTML = `
                <div class="recommendations-title">
                    <i class="bi bi-stars"></i> –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –±–∞–ª–∞–Ω—Å
                </div>
                <p>–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å ‚Äî —É–∂–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ! –ù–æ —á—Ç–æ–±—ã –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —É–≥–ª—É–±–∏—Ç—å—Å—è –≤ –æ–¥–Ω—É –∏–∑ —Å—Ñ–µ—Ä, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç —É –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å.</p>
                ${goalReminder}
            `;
        }
        recommendationsText.innerHTML = recommendationsHTML;
    }

    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    function updateNavigationButtons(index) {
        const prevBtn = document.getElementById('prevDate');
        const nextBtn = document.getElementById('nextDate');
        const todayBtn = document.getElementById('todayDate');
        const dateSelector = document.getElementById('dateSelector');
        if (prevBtn) prevBtn.disabled = index >= allDates.length - 1;
        if (nextBtn) nextBtn.disabled = index <= 0;
        if (todayBtn) {
            todayBtn.classList.remove('btn-primary', 'btn-outline-primary');
            if (index === 0) {
                todayBtn.classList.add('btn-primary');
            } else {
                todayBtn.classList.add('btn-outline-primary');
            }
        }
        if (dateSelector) dateSelector.value = allDates[index];
    }

    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
    function formatDate(dateStr) {
        try {
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
        } catch (e) {
            return dateStr;
        }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    if (allDates.length > 0) {
        updateChart(currentDateIndex);
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    // –ö–Ω–æ–ø–∫–∞ "–†–∞–Ω–µ–µ"
    const prevBtn = document.getElementById('prevDate');
    if (prevBtn) {
        prevBtn.addEventListener('click', function () {
            if (currentDateIndex < allDates.length - 1) {
                currentDateIndex++;
                updateChart(currentDateIndex);
            }
        });
    }

    // –ö–Ω–æ–ø–∫–∞ "–ü–æ–∑–∂–µ"
    const nextBtn = document.getElementById('nextDate');
    if (nextBtn) {
        nextBtn.addEventListener('click', function () {
            if (currentDateIndex > 0) {
                currentDateIndex--;
                updateChart(currentDateIndex);
            }
        });
    }

    // –ö–Ω–æ–ø–∫–∞ "–°–µ–≥–æ–¥–Ω—è" (–ø–æ—Å–ª–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞)
    const todayBtn = document.getElementById('todayDate');
    if (todayBtn) {
        todayBtn.addEventListener('click', function () {
            currentDateIndex = 0;
            updateChart(currentDateIndex);
        });
    }

    // –°–µ–ª–µ–∫—Ç–æ—Ä –¥–∞—Ç—ã
    const dateSelector = document.getElementById('dateSelector');
    if (dateSelector) {
        dateSelector.addEventListener('change', function () {
            const selectedDate = this.value;
            currentDateIndex = allDates.indexOf(selectedDate);
            if (currentDateIndex !== -1) {
                updateChart(currentDateIndex);
            }
        });
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (–≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏)
    const compareToggle = document.getElementById('compareToggle');
    if (compareToggle) {
        compareToggle.addEventListener('change', function () {
            isComparing = this.checked;
            updateChart(currentDateIndex);
        });
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –±–ª–æ–∫–µ)
    const compareToggleInComparison = document.getElementById('compareToggleInComparison');
    if (compareToggleInComparison) {
        compareToggleInComparison.addEventListener('change', function () {
            isComparing = this.checked;
            updateChart(currentDateIndex);
        });
    }

    // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–≤
    const progressBars = document.querySelectorAll('.progress-fill');
    progressBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => {
            bar.style.width = width;
        }, 300);
    });

    // –ê–Ω–∏–º–∞—Ü–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤ –¥–∏–∞–≥—Ä–∞–º–º—ã
    const assessmentBars = document.querySelectorAll('.assessment-fill');
    assessmentBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => {
            bar.style.width = width;
        }, 500);
    });

    // –≠–∫—Å–ø–æ—Ä—Ç –¥–∏–≥—Ä–∞–º–º—ã —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
    document.getElementById('export-wheel-pdf').addEventListener('click', function () {
        const btn = this;
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>–°–æ–∑–¥–∞–Ω–∏–µ...';
        btn.disabled = true;

        try {
            const canvas = document.getElementById('lifeWheel');
            if (!canvas) throw new Error('–î–∏–∞–≥—Ä–∞–º–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');

            // –ü–æ–ª—É—á–∞–µ–º –¥–∞—Ç—É –æ—Ü–µ–Ω–∫–∏
            const dateLabel = (document.getElementById('wheelDateLabel')?.textContent || '').replace(/<[^>]*>/g, '').trim() || '–ë–µ–∑ –¥–∞—Ç—ã';

            // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–≤—Å–µ–≥–¥–∞, –µ—Å–ª–∏ –µ—Å—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ)
            let recommendationsText = '';
            const recommendationsEl = document.getElementById('recommendationsText');
            if (recommendationsEl && recommendationsEl.textContent.trim()) {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = recommendationsEl.innerHTML;
                recommendationsText = tempDiv.innerText.trim();
            }

            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º canvas –≤ base64
            const imgData = canvas.toDataURL('image/png');

            // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ PDF
            const content = [
                { text: '–ö–æ–ª–µ—Å–æ –∂–∏–∑–Ω–∏', style: 'header', alignment: 'center' },
                { text: dateLabel, style: 'subheader', alignment: 'center', margin: [0, 0, 0, 15] },
                { image: imgData, width: 400, height: 350, alignment: 'center', margin: [0, 0, 0, 15] } // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ 350px
            ];

            // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, –µ—Å–ª–∏ –µ—Å—Ç—å
            if (recommendationsText) {
                content.push(
                    { text: '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏', style: 'sectionHeader', margin: [0, 0, 0, 8] },
                    { text: recommendationsText, style: 'bodyText' }
                );
            }

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∏–ª–∏
            const docDefinition = {
                pageSize: 'A4',
                pageOrientation: 'portrait',
                pageMargins: [40, 50, 40, 40],
                content: content,
                styles: {
                    header: {
                        fontSize: 18,
                        bold: true,
                        color: '#4A6FA5',
                        margin: [0, 0, 0, 5]
                    },
                    subheader: {
                        fontSize: 12,
                        color: '#666666',
                        italics: true
                    },
                    sectionHeader: {
                        fontSize: 14,
                        bold: true,
                        color: '#4A6FA5',
                        margin: [0, 10, 0, 5]
                    },
                    bodyText: {
                        fontSize: 10,
                        lineHeight: 1.3,
                        margin: [0, 0, 0, 10]
                    }
                },
                defaultStyle: {
                    font: 'Roboto'
                }
            };

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏ —Å–∫–∞—á–∏–≤–∞–µ–º PDF
            pdfMake.createPdf(docDefinition).download('–∫–æ–ª–µ—Å–æ_–∂–∏–∑–Ω–∏_' + new Date().toISOString().slice(0, 10) + '.pdf');

            // –£—Å–ø–µ—Ö
            btn.innerHTML = '<i class="bi bi-check-circle me-2"></i>–°–æ–∑–¥–∞–Ω–æ!';
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }, 2000);

        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PDF:', error);
            btn.innerHTML = '<i class="bi bi-x-circle me-2"></i>–û—à–∏–±–∫–∞!';
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }, 3000);
        }
    });
});
</script>
{% endblock %}