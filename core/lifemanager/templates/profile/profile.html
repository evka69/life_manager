{% extends 'base.html' %}
{% block title %}–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç{% endblock %}

{% block content %}
<div class="container py-4">
    <h1 class="mb-4">üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>

    <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">–ú–æ–∏ –¥–∞–Ω–Ω—ã–µ</h5>
            <p><strong>–ò–º—è:</strong> {{ user.name }}</p>
            <p><strong>Email:</strong> {{ user.email }}</p>
            <a href="{% url 'password_change' %}" class="btn btn-outline-primary">
                <i class="bi bi-key"></i> –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
            </a>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ü–µ–Ω–æ–∫ -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ü–µ–Ω–æ–∫ –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å—Ñ–µ—Ä</h5>
            <div class="row text-center">
                <div class="col-md-4 mb-3 mb-md-0">
                    <div class="stat-item">
                        <div class="stat-value">{{ total_assessments }}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –æ—Ü–µ–Ω–æ–∫</div>
                    </div>
                </div>
                <div class="col-md-4 mb-3 mb-md-0">
                    <div class="stat-item">
                        <div class="stat-value">{{ last_week_count }}</div>
                        <div class="stat-label">–ó–∞ –Ω–µ–¥–µ–ª—é</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-item">
                        <div class="stat-value">{{ average_score }}</div>
                        <div class="stat-label">–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞</div>
                    </div>
                </div>
            </div>
            <div class="text-center mt-3">
                <a href="{% url 'assessment_history' %}" class="btn btn-sm btn-outline-secondary">
                    ‚Üí –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –æ—Ü–µ–Ω–æ–∫
                </a>
            </div>
        </div>
    </div>

    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ü–µ–ª–∏ -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="card-title mb-0">üéØ –ú–æ–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ü–µ–ª–∏</h5>
                <a href="{% url 'goal_list' %}" class="btn btn-sm btn-outline-secondary">‚Üí –í—Å–µ —Ü–µ–ª–∏</a>
            </div>
            {% if recent_goals %}
                <div class="list-group">
                    {% for goal in recent_goals %}
                    <a href="{% url 'edit_goal' goal.id %}" class="list-group-item list-group-item-action">
                        <div class="d-flex justify-content-between">
                            <strong>{{ goal.title }}</strong>
                            <span class="badge bg-{{ goal.status|yesno:'success,warning,secondary' }}">{{ goal.get_status_display }}</span>
                        </div>
                        <small class="text-muted">–î–µ–¥–ª–∞–π–Ω: {{ goal.deadline|date:"d E Y" }} ‚Ä¢ {{ goal.sphere.title }}</small>
                    </a>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-muted">–ù–µ—Ç —Ü–µ–ª–µ–π. <a href="{% url 'create_goal' %}">–°–æ–∑–¥–∞—Ç—å —Ü–µ–ª—å ‚Üí</a></p>
            {% endif %}
        </div>
    </div>

    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –¥–Ω–µ–≤–Ω–∏–∫–∞ -->
    <div class="card">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="card-title mb-0">üìì –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏</h5>
                <a href="{% url 'diary_list' %}" class="btn btn-sm btn-outline-secondary">‚Üí –í–µ—Å—å –¥–Ω–µ–≤–Ω–∏–∫</a>
            </div>
            {% if recent_entries %}
                <div class="list-group">
                    {% for entry in recent_entries %}
                    <a href="{% url 'edit_diary_entry' entry.id %}" class="list-group-item list-group-item-action">
                        <div class="d-flex justify-content-between">
                            <span>{{ entry.text|truncatewords:15 }}</span>
                            <small class="text-muted">{{ entry.created_at|date:"d.m.Y H:i" }}</small>
                        </div>
                        {% if entry.sphere or entry.goal %}
                        <small class="text-muted">
                            {% if entry.sphere %}{{ entry.sphere.title }}{% endif %}
                            {% if entry.goal %} ‚Üí {{ entry.goal.title }}{% endif %}
                        </small>
                        {% endif %}
                    </a>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-muted">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π. <a href="{% url 'create_diary_entry' %}">–°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å ‚Üí</a></p>
            {% endif %}
        </div>
    </div>
    <div class="card mb-4">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">üìì –ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏</h5>
                <a href="{% url 'note_list' %}" class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-arrow-right"></i>
                </a>
            </div>
            <p class="text-muted mt-2">–û—Ä–≥–∞–Ω–∏–∑—É–π—Ç–µ –∑–∞–¥–∞—á–∏ –∏ –º—ã—Å–ª–∏ —Å –ø–æ–º–æ—â—å—é —á–µ–∫–ª–∏—Å—Ç–æ–≤</p>
        </div>
    </div>
</div>
{% endblock %}