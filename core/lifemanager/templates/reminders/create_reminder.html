{% extends 'base.html' %}
{% block title %}–°–æ–∑–¥–∞—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ ‚Äî LIFE BALANCE{% endblock %}

{% block extra_css %}
<style>
    .reminder-container {
        max-width: 600px;
        margin: 0 auto;
    }

    .reminder-header {
        background: linear-gradient(135deg, rgba(74, 111, 165, 0.1) 0%, rgba(74, 111, 165, 0.05) 100%);
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 2rem;
        border-left: 5px solid var(--primary);
    }

    .reminder-card {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        border: 1px solid rgba(0,0,0,0.05);
    }

    .form-group-custom {
        margin-bottom: 1.8rem;
    }

    .form-label {
        display: block;
        margin-bottom: 0.6rem;
        font-weight: 600;
        color: #2c3e50;
        font-size: 1rem;
    }

    .form-control-custom {
        width: 100%;
        padding: 0.9rem 1rem;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        font-size: 1rem;
        transition: all 0.3s ease;
        background-color: #f8f9fa;
    }

    .form-control-custom:focus {
        outline: none;
        border-color: var(--primary);
        background-color: white;
        box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.1);
    }

    .select-icon {
        position: relative;
    }

    .select-icon select {
        padding-left: 2.5rem;
    }

    .select-icon i {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--primary);
        font-size: 1.1rem;
        z-index: 10;
    }

    .reminder-type-card {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        border-left: 4px solid var(--primary);
        transition: var(--transition);
        cursor: pointer;
    }

    .reminder-type-card:hover {
        background: #e9ecef;
        transform: translateY(-2px);
    }

    .reminder-type-card.selected {
        background: rgba(74, 111, 165, 0.1);
        border-left-color: var(--primary);
    }

    .type-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--primary);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.3rem;
        margin-right: 1rem;
    }

    .type-title {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 0.25rem;
    }

    .type-description {
        font-size: 0.9rem;
        color: #6c757d;
        margin: 0;
    }

    .time-picker {
        position: relative;
    }

    .time-picker input {
        padding-left: 2.5rem;
    }

    .time-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--primary);
        font-size: 1.1rem;
    }

    .goal-select {
        position: relative;
    }

    .goal-select select {
        padding-left: 2.5rem;
    }

    .goal-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--primary);
        font-size: 1.1rem;
    }

    .info-tip {
        background: rgba(56, 178, 172, 0.1);
        border-radius: 8px;
        padding: 1rem;
        margin: 1.5rem 0;
        border-left: 3px solid var(--success);
    }

    .info-tip i {
        color: var(--success);
        margin-right: 0.5rem;
    }

    .btn-primary-custom {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
        color: white;
        border: none;
        border-radius: 10px;
        padding: 1rem 2rem;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
        margin-top: 0.5rem;
    }

    .btn-primary-custom:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(74, 111, 165, 0.3);
    }

    .btn-outline-custom {
        background: white;
        color: var(--primary);
        border: 2px solid var(--primary);
        border-radius: 10px;
        padding: 1rem 2rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
        margin-top: 1rem;
        text-decoration: none;
        display: inline-block;
        text-align: center;
    }

    .btn-outline-custom:hover {
        background: var(--primary);
        color: white;
        text-decoration: none;
    }

    .reminder-preview {
        background: linear-gradient(135deg, rgba(241, 196, 15, 0.1) 0%, rgba(241, 196, 15, 0.05) 100%);
        border-radius: 12px;
        padding: 1.5rem;
        margin-top: 2rem;
        border-left: 4px solid #f1c40f;
        display: none;
    }

    .preview-title {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
    }

    .preview-details {
        color: #6c757d;
        font-size: 0.95rem;
    }

    @media (max-width: 768px) {
        .reminder-container {
            padding: 0 1rem;
        }

        .reminder-header {
            padding: 1.5rem;
        }

        .reminder-card {
            padding: 1.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="reminder-container fade-in">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="reminder-header">
        <div class="d-flex align-items-center">
            <div class="me-3">
                <i class="bi bi-bell-fill" style="font-size: 2.5rem; color: var(--primary);"></i>
            </div>
            <div>
                <h1 class="display-6 fw-bold mb-2" style="color: var(--primary);">–°–æ–∑–¥–∞—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ</h1>
                <p class="lead mb-0 text-muted">
                    –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–º–æ–≥—É—Ç –≤–∞–º –Ω–µ –∑–∞–±—ã–≤–∞—Ç—å –æ –≤–∞–∂–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è—Ö –∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–π —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏.
                    –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –µ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.
                </p>
            </div>
        </div>
    </div>

    <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è -->
    <div class="reminder-card">
        <form method="post" id="reminderForm">
            {% csrf_token %}

            <!-- –í—ã–±–æ—Ä —Ç–∏–ø–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è -->
            <div class="form-group-custom">
                <label class="form-label">–¢–∏–ø –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</label>

                <div class="mb-3" id="typeSelector">
                    <div class="reminder-type-card" data-type="daily">
                        <div class="d-flex align-items-center">
                            <div class="type-icon">
                                <i class="bi bi-calendar-day"></i>
                            </div>
                            <div class="flex-grow-1">
                                <div class="type-title">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ</div>
                                <p class="type-description">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –±—É–¥–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è</p>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="type" value="daily" id="typeDaily" required>
                            </div>
                        </div>
                    </div>

                    <div class="reminder-type-card" data-type="weekly">
                        <div class="d-flex align-items-center">
                            <div class="type-icon">
                                <i class="bi bi-calendar-week"></i>
                            </div>
                            <div class="flex-grow-1">
                                <div class="type-title">–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–µ</div>
                                <p class="type-description">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –±—É–¥–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è</p>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="type" value="weekly" id="typeWeekly">
                            </div>
                        </div>
                    </div>

                    <div class="reminder-type-card" data-type="deadline_based">
                        <div class="d-flex align-items-center">
                            <div class="type-icon">
                                <i class="bi bi-calendar-check"></i>
                            </div>
                            <div class="flex-grow-1">
                                <div class="type-title">–ü–æ –¥–µ–¥–ª–∞–π–Ω—É —Ü–µ–ª–∏</div>
                                <p class="type-description">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –¥–µ–¥–ª–∞–π–Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ü–µ–ª–∏</p>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="type" value="deadline_based" id="typeDeadline">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ -->
            <div class="form-group-custom">
                <label for="time" class="form-label">–í—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</label>
                <div class="time-picker">
                    <i class="bi bi-clock time-icon"></i>
                    <input type="time"
                           name="time"
                           id="time"
                           class="form-control-custom"
                           required
                           value="09:00">
                </div>
            </div>

            <!-- –í—ã–±–æ—Ä —Ü–µ–ª–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
            <div class="form-group-custom">
                <label for="goal" class="form-label">–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ —Ü–µ–ª–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                <div class="goal-select">
                    <i class="bi bi-flag goal-icon"></i>
                    <select name="goal" id="goal" class="form-control-custom">
                        <option value="">‚Äî –ù–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å ‚Äî</option>
                        {% for goal in goals %}
                            <option value="{{ goal.id }}">{{ goal.title }} (–¥–æ {{ goal.deadline|date:"d.m.Y" }})</option>
                        {% endfor %}
                    </select>
                </div>
                <small class="text-muted">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–æ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ü–µ–ª—å—é –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞</small>
            </div>

            <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∞ -->
            <div class="info-tip">
                <i class="bi bi-lightbulb"></i>
                <strong>–°–æ–≤–µ—Ç:</strong> –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–º–æ–≥–∞—é—Ç —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–µ–∑–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏
                –∏ –Ω–µ –∑–∞–±—ã–≤–∞—Ç—å –æ –≤–∞–∂–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è—Ö. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –Ω–∞ —É–¥–æ–±–Ω–æ–µ –¥–ª—è –≤–∞—Å –≤—Ä–µ–º—è,
                –∫–æ–≥–¥–∞ –≤—ã –æ–±—ã—á–Ω–æ –º–æ–∂–µ—Ç–µ —É–¥–µ–ª–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏.
            </div>

            <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
            <div class="reminder-preview" id="reminderPreview">
                <div class="preview-title">
                    <i class="bi bi-eye me-2"></i>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
                </div>
                <div class="preview-details">
                    <div id="previewText">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –±—É–¥–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏</div>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ -->
            <button type="submit" class="btn-primary-custom">
                <i class="bi bi-check-circle me-2"></i>–°–æ–∑–¥–∞—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
            </button>

            <a href="{% url 'dashboard' %}" class="btn-outline-custom">
                <i class="bi bi-x-circle me-2"></i>–û—Ç–º–µ–Ω–∞
            </a>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // –≠–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã
    const typeCards = document.querySelectorAll('.reminder-type-card');
    const typeInputs = document.querySelectorAll('input[name="type"]');
    const timeInput = document.getElementById('time');
    const goalSelect = document.getElementById('goal');
    const reminderPreview = document.getElementById('reminderPreview');
    const previewText = document.getElementById('previewText');

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
    typeCards.forEach(card => {
        card.addEventListener('click', function() {
            const type = this.dataset.type;

            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
            typeCards.forEach(c => c.classList.remove('selected'));

            // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É
            this.classList.add('selected');

            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π radio button
            document.getElementById(`type${type.charAt(0).toUpperCase() + type.slice(1).replace('_based', '')}`).checked = true;

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
            updatePreview();
        });
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è radio buttons
    typeInputs.forEach(input => {
        input.addEventListener('change', function() {
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
            typeCards.forEach(c => c.classList.remove('selected'));

            // –í—ã–¥–µ–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–∞—Ä—Ç–æ—á–∫—É
            const type = this.value;
            const card = document.querySelector(`[data-type="${type}"]`);
            if (card) {
                card.classList.add('selected');
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
            updatePreview();
        });
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    timeInput.addEventListener('change', updatePreview);
    goalSelect.addEventListener('change', updatePreview);

    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    function updatePreview() {
        const type = document.querySelector('input[name="type"]:checked')?.value;
        const time = timeInput.value;
        const goalId = goalSelect.value;
        const goalText = goalSelect.options[goalSelect.selectedIndex]?.text || '';

        if (!type || !time) {
            reminderPreview.style.display = 'none';
            return;
        }

        let preview = '';

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
        let typeText = '';
        switch(type) {
            case 'daily':
                typeText = '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ';
                break;
            case 'weekly':
                typeText = '–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ';
                break;
            case 'deadline_based':
                typeText = '–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø–æ –¥–µ–¥–ª–∞–π–Ω—É —Ü–µ–ª–∏';
                break;
        }

        preview += `<strong>${typeText}</strong><br>`;
        preview += `‚è∞ –í—Ä–µ–º—è: ${time}<br>`;

        if (goalId) {
            preview += `üéØ –¶–µ–ª—å: ${goalText.split(' (–¥–æ')[0]}<br>`;
        } else {
            preview += `üìù –û–±—â–µ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏<br>`;
        }

        // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é
        preview += `<small class="text-muted mt-2"><i class="bi bi-info-circle"></i> –í—ã –ø–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è</small>`;

        previewText.innerHTML = preview;
        reminderPreview.style.display = 'block';
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    updatePreview();

    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
    typeCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(10px)';
        setTimeout(() => {
            card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100 + 200);
    });

    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
    const reminderForm = document.getElementById('reminderForm');
    reminderForm.addEventListener('submit', function(e) {
        const type = document.querySelector('input[name="type"]:checked');
        const time = timeInput.value;

        if (!type || !time) {
            e.preventDefault();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
            if (!document.querySelector('.alert-error')) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'alert-custom alert-error';
                errorDiv.innerHTML = `
                    <i class="bi bi-exclamation-triangle alert-icon"></i>
                    –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏ –≤—Ä–µ–º—è
                `;
                errorDiv.style.marginBottom = '1.5rem';
                errorDiv.style.padding = '1rem';
                errorDiv.style.borderRadius = '10px';
                errorDiv.style.backgroundColor = 'rgba(231, 76, 60, 0.1)';
                errorDiv.style.border = '1px solid rgba(231, 76, 60, 0.3)';
                errorDiv.style.color = '#c0392b';

                reminderForm.prepend(errorDiv);

                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –æ—à–∏–±–∫–µ
                errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
    });

    // –ê–≤—Ç–æ–≤—ã–±–æ—Ä –ø–µ—Ä–≤–æ–≥–æ —Ç–∏–ø–∞
    if (typeCards.length > 0) {
        typeCards[0].click();
    }
});
</script>
{% endblock %}