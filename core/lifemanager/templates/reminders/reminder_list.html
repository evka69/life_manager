{% extends 'base.html' %}
{% block title %}Мои напоминания — LIFE BALANCE{% endblock %}
{% block extra_css %}
<style>
    .reminders-container {
        max-width: 900px;
        margin: 0 auto;
    }

    .reminders-header {
        background: linear-gradient(135deg, rgba(74, 111, 165, 0.1) 0%, rgba(74, 111, 165, 0.05) 100%);
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 2rem;
        border-left: 5px solid var(--primary);
    }

    .reminder-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        border-left: 4px solid var(--primary);
        transition: var(--transition);
    }

    .reminder-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }

    .reminder-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
        margin-right: 1rem;
        flex-shrink: 0;
    }

    .icon-daily {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
    }

    .icon-weekly {
        background: linear-gradient(135deg, var(--info) 0%, #5dade2 100%);
    }

    .icon-deadline {
        background: linear-gradient(135deg, var(--success) 0%, #2ecc71 100%);
    }

    .reminder-title {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 0.25rem;
    }

    .reminder-meta {
        color: #6c757d;
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }

    .reminder-goal {
        display: inline-block;
        background: rgba(74, 111, 165, 0.1);
        color: var(--primary);
        padding: 0.2rem 0.6rem;
        border-radius: 12px;
        font-size: 0.85rem;
        margin-top: 0.5rem;
    }

    .reminder-actions {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-top: 1rem;
    }

    .status-toggle {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .status-badge {
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-weight: 500;
        font-size: 0.85rem;
    }

    .status-active {
        background-color: rgba(46, 204, 113, 0.15);
        color: #27ae60;
    }

    .status-inactive {
        background-color: rgba(236, 240, 241, 0.8);
        color: #7f8c8d;
    }

    .empty-reminders {
        text-align: center;
        padding: 4rem 2rem;
        background: white;
        border-radius: 16px;
        box-shadow: 0 8px 30px rgba(0,0,0,0.05);
    }

    .empty-icon {
        font-size: 4rem;
        color: #bdc3c7;
        margin-bottom: 1.5rem;
    }

    /* Toggle switch */
    .switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 34px;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }

    input:checked + .slider {
        background-color: var(--primary);
    }

    input:checked + .slider:before {
        transform: translateX(26px);
    }

    .create-btn {
        display: inline-flex;
        align-items: center;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
        color: white;
        border: none;
        border-radius: 10px;
        padding: 0.8rem 1.5rem;
        font-weight: 600;
        text-decoration: none;
        transition: var(--transition);
    }

    .create-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(74, 111, 165, 0.3);
        color: white;
        text-decoration: none;
    }

    .stats-card {
        background: linear-gradient(135deg, rgba(56, 178, 172, 0.1) 0%, rgba(56, 178, 172, 0.05) 100%);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border: 1px solid rgba(56, 178, 172, 0.2);
    }

    .stat-item {
        text-align: center;
        padding: 1rem;
    }

    .stat-value {
        font-family: 'Montserrat', sans-serif;
        font-weight: 700;
        font-size: 2rem;
        color: var(--success);
        margin-bottom: 0.5rem;
    }

    .stat-label {
        font-size: 0.9rem;
        color: #7f8c8d;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* Стили пагинации */
    .pagination-container {
        display: flex;
        justify-content: center;
        margin-top: 3rem;
        padding-top: 2rem;
        border-top: 1px solid #e9ecef;
    }

    .pagination {
        display: flex;
        list-style: none;
        padding: 0;
        margin: 0;
        gap: 0.5rem;
    }

    .page-item {
        margin: 0;
    }

    .page-link {
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 40px;
        height: 40px;
        padding: 0 0.75rem;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        background-color: white;
        color: var(--primary);
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .page-link:hover {
        background-color: var(--primary);
        color: white;
        border-color: var(--primary);
        transform: translateY(-2px);
    }

    .page-item.active .page-link {
        background-color: var(--primary);
        color: white;
        border-color: var(--primary);
    }

    .page-item.disabled .page-link {
        opacity: 0.5;
        cursor: not-allowed;
        background-color: #f8f9fa;
    }

    .page-info {
        text-align: center;
        color: #6c757d;
        font-size: 0.9rem;
        margin-top: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="reminders-container fade-in">
    <!-- Заголовок -->
    <div class="reminders-header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="display-6 fw-bold mb-2" style="color: var(--primary);">
                    <i class="bi bi-bell-fill me-2"></i>Мои напоминания
                </h1>
                <p class="lead mb-0 text-muted">
                    Управляйте всеми вашими напоминаниями в одном месте.
                    Регулярные уведомления помогут не забывать о важных действиях.
                </p>
            </div>
            <a href="{% url 'create_reminder' %}" class="create-btn">
                <i class="bi bi-plus-circle me-2"></i>Новое напоминание
            </a>
        </div>
    </div>

    {% if reminders %}
        <!-- Статистика -->
        <div class="stats-card">
            <div class="row text-center">
                <div class="col-md-4">
                    <div class="stat-item">
                        <div class="stat-value">{{ total_count }}</div>
                        <div class="stat-label">Всего напоминаний</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-item">
                        <div class="stat-value">{{ active_count }}</div>
                        <div class="stat-label">Активных</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-item">
                        <div class="stat-value">{{ daily_count }}</div>
                        <div class="stat-label">Ежедневных</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Список напоминаний -->
        <div class="mt-4">
            <h3 class="mb-4" style="color: var(--primary);">
                <i class="bi bi-list-check me-2"></i>Все напоминания
                <span class="badge bg-primary ms-2">Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>
            </h3>

            {% for reminder in reminders %}
            <div class="reminder-card">
                <div class="row align-items-center">
                    <div class="col-md-9">
                        <div class="d-flex align-items-start">
                            <!-- Иконка -->
                            <div class="reminder-icon {% if reminder.type == 'daily' %}icon-daily{% elif reminder.type == 'weekly' %}icon-weekly{% else %}icon-deadline{% endif %}">
                                {% if reminder.type == 'daily' %}
                                    <i class="bi bi-calendar-day"></i>
                                {% elif reminder.type == 'weekly' %}
                                    <i class="bi bi-calendar-week"></i>
                                {% else %}
                                    <i class="bi bi-calendar-check"></i>
                                {% endif %}
                            </div>

                            <!-- Информация -->
                            <div class="flex-grow-1">
                                <div class="reminder-title">
                                    {{ reminder.get_type_display }}
                                </div>
                                <div class="reminder-meta">
                                    <i class="bi bi-clock me-1"></i>В {{ reminder.time }}
                                    {% if reminder.type == 'deadline_based' and reminder.goal %}
                                        • Дедлайн: {{ reminder.goal.deadline|date:"d.m.Y" }}
                                    {% endif %}
                                </div>

                                {% if reminder.goal %}
                                <div class="reminder-goal">
                                    <i class="bi bi-flag me-1"></i>{{ reminder.goal.title }}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
    <div class="reminder-actions d-flex align-items-center gap-2">
        <!-- Переключатель статуса -->
        <div class="status-toggle">
            <label class="switch">
                <input type="checkbox"
                       onchange="toggleReminder('{{ reminder.id }}')"
                       {% if reminder.is_enabled %}checked{% endif %}>
                <span class="slider"></span>
            </label>
            <span class="status-badge {% if reminder.is_enabled %}status-active{% else %}status-inactive{% endif %}">
                {% if reminder.is_enabled %}
                    <i class="bi bi-bell-fill me-1"></i>Активно
                {% else %}
                    <i class="bi bi-bell-slash me-1"></i>Отключено
                {% endif %}
            </span>
        </div>

        <!-- Кнопка удаления (только для выключенных) -->
        {% if not reminder.is_enabled %}
        <a href="{% url 'delete_reminder' reminder.id %}"
           class="btn btn-sm btn-outline-danger"
           title="Удалить напоминание">
            <i class="bi bi-trash"></i>
        </a>
        {% endif %}
    </div>
</div>
                </div>
            </div>
            {% endfor %}

            <!-- Пагинация -->
            {% if page_obj.paginator.num_pages > 1 %}
            <div class="pagination-container">
                <nav aria-label="Навигация по страницам">
                    <ul class="pagination">
                        {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page=1" aria-label="Первая">
                                <i class="bi bi-chevron-double-left"></i>
                            </a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Предыдущая">
                                <i class="bi bi-chevron-left"></i>
                            </a>
                        </li>
                        {% else %}
                        <li class="page-item disabled">
                            <span class="page-link">
                                <i class="bi bi-chevron-double-left"></i>
                            </span>
                        </li>
                        <li class="page-item disabled">
                            <span class="page-link">
                                <i class="bi bi-chevron-left"></i>
                            </span>
                        </li>
                        {% endif %}

                        <!-- Номера страниц -->
                        {% for num in page_obj.paginator.page_range %}
                            {% if num == page_obj.number %}
                            <li class="page-item active">
                                <span class="page-link">{{ num }}</span>
                            </li>
                            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                            </li>
                            {% elif num == page_obj.number|add:'-3' or num == page_obj.number|add:'3' %}
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                            {% endif %}
                        {% endfor %}

                        {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Следующая">
                                <i class="bi bi-chevron-right"></i>
                            </a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}" aria-label="Последняя">
                                <i class="bi bi-chevron-double-right"></i>
                            </a>
                        </li>
                        {% else %}
                        <li class="page-item disabled">
                            <span class="page-link">
                                <i class="bi bi-chevron-right"></i>
                            </span>
                        </li>
                        <li class="page-item disabled">
                            <span class="page-link">
                                <i class="bi bi-chevron-double-right"></i>
                            </span>
                        </li>
                        {% endif %}
                    </ul>

                    <div class="page-info">
                        Показано {{ page_obj.start_index }}–{{ page_obj.end_index }} из {{ total_count }} напоминаний
                    </div>
                </nav>
            </div>
            {% endif %}
        </div>
    {% else %}
        <!-- Состояние без напоминаний -->
        <div class="empty-reminders">
            <div class="empty-icon">
                <i class="bi bi-bell-slash"></i>
            </div>
            <h3 class="mb-3" style="color: var(--primary);">Нет напоминаний</h3>
            <p class="text-muted mb-4" style="max-width: 500px; margin: 0 auto;">
                Напоминания помогут вам не забывать о важных действиях и регулярной рефлексии.
                Создайте первое напоминание, чтобы начать получать полезные уведомления.
            </p>
            <a href="{% url 'create_reminder' %}" class="btn btn-primary btn-lg">
                <i class="bi bi-plus-circle me-2"></i>Создать первое напоминание
            </a>
        </div>
    {% endif %}

    <!-- Подсказки -->
    <div class="row mt-5 pt-4 border-top">
        <div class="col-md-6">
            <div class="d-flex align-items-center">
                <div class="me-3">
                    <i class="bi bi-info-circle-fill" style="font-size: 2rem; color: var(--info);"></i>
                </div>
                <div>
                    <h5 class="mb-1">Зачем нужны напоминания?</h5>
                    <p class="mb-0 text-muted small">
                        Регулярные напоминания помогают формировать полезные привычки
                        и не забывать о важных действиях. Они особенно полезны для поддержания
                        регулярности в оценке сфер жизни и отслеживании целей.
                    </p>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="d-flex align-items-center">
                <div class="me-3">
                    <i class="bi bi-lightbulb-fill" style="font-size: 2rem; color: #f1c40f;"></i>
                </div>
                <div>
                    <h5 class="mb-1">Как использовать эффективно?</h5>
                    <p class="mb-0 text-muted small">
                        Установите напоминания на удобное для вас время, когда вы обычно
                        можете уделить несколько минут рефлексии. Начинайте с одного-двух
                        напоминаний и добавляйте новые по мере необходимости.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Кнопки навигации -->
    <div class="text-center mt-5">
        <a href="{% url 'dashboard' %}" class="btn btn-outline-primary me-3">
            <i class="bi bi-arrow-left me-2"></i>На главную
        </a>
        <a href="{% url 'create_reminder' %}" class="btn btn-primary">
            <i class="bi bi-plus-circle me-2"></i>Добавить напоминание
        </a>
    </div>
</div>

<script>
// Функция переключения статуса напоминания
function toggleReminder(reminderId) {
    const checkbox = event.target;
    const originalState = checkbox.checked;

    // Инвертируем для отправки (чтобы сразу показать изменение)
    checkbox.checked = !originalState;

    // Отправляем запрос на сервер
    fetch(`/reminders/${reminderId}/toggle/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCookie('csrftoken'),
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        credentials: 'same-origin'
    })
    .then(response => {
        if (response.ok) {
            // Обновляем статус в интерфейсе
            const badge = event.target.closest('.status-toggle').querySelector('.status-badge');

            if (checkbox.checked) {
                badge.className = 'status-badge status-active';
                badge.innerHTML = '<i class="bi bi-bell-fill me-1"></i>Активно';
                showNotification('Напоминание включено', 'success');
            } else {
                badge.className = 'status-badge status-inactive';
                badge.innerHTML = '<i class="bi bi-bell-slash me-1"></i>Отключено';
                showNotification('Напоминание отключено', 'info');
            }

            // Обновляем счетчик активных напоминаний
            updateActiveCount();
        } else {
            // Если ошибка, возвращаем переключатель в исходное состояние
            checkbox.checked = originalState;
            showNotification('Ошибка при обновлении статуса', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        checkbox.checked = originalState;
        showNotification('Ошибка сети', 'error');
    });
}

// Функция для обновления счетчика активных напоминаний
function updateActiveCount() {
    const activeBadges = document.querySelectorAll('.status-badge.status-active');
    const activeCountElement = document.querySelector('.stat-item:nth-child(2) .stat-value');
    if (activeCountElement) {
        activeCountElement.textContent = activeBadges.length;
    }
}

// Функция для получения CSRF токена
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Функция для показа уведомлений
function showNotification(message, type = 'info') {
    // Создаем элемент уведомления
    const notification = document.createElement('div');
    notification.className = `alert alert-${type === 'error' ? 'danger' : type === 'success' ? 'success' : 'info'}
                              position-fixed top-0 end-0 m-3`;
    notification.style.zIndex = '9999';
    notification.innerHTML = `
        <div class="d-flex align-items-center">
            <i class="bi ${type === 'error' ? 'bi-exclamation-triangle' : type === 'success' ? 'bi-check-circle' : 'bi-info-circle'}
               me-2"></i>
            ${message}
        </div>
    `;

    // Добавляем на страницу
    document.body.appendChild(notification);

    // Удаляем через 3 секунды
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// Анимация появления карточек
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.reminder-card');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        setTimeout(() => {
            card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });

    // Плавный скролл при переходе по страницам
    const pageLinks = document.querySelectorAll('.page-link[href*="page="]');
    pageLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            setTimeout(() => {
                window.scrollTo({
                    top: document.querySelector('.reminders-container').offsetTop - 100,
                    behavior: 'smooth'
                });
            }, 100);
        });
    });
});
</script>
{% endblock %}