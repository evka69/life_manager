{% extends 'base.html' %}
{% block title %}–ò—Å—Ç–æ—Ä–∏—è –æ—Ü–µ–Ω–æ–∫ ‚Äî LIFE BALANCE{% endblock %}

{% block extra_css %}
<style>
    .history-container {
        max-width: 900px;
        margin: 0 auto;
    }

    .history-header {
        background: linear-gradient(135deg, rgba(74, 111, 165, 0.1) 0%, rgba(74, 111, 165, 0.05) 100%);
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 2rem;
        border-left: 5px solid var(--primary);
    }

    .assessment-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        border-left: 4px solid var(--primary);
        transition: var(--transition);
    }

    .assessment-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }

    .assessment-score {
        font-family: 'Montserrat', sans-serif;
        font-weight: 700;
        font-size: 2rem;
        color: var(--primary);
        min-width: 70px;
        text-align: center;
    }

    .score-indicator {
        width: 100%;
        height: 8px;
        background: #ecf0f1;
        border-radius: 4px;
        overflow: hidden;
        margin-top: 0.5rem;
    }

    .score-fill {
        height: 100%;
        border-radius: 4px;
        transition: width 1s ease-in-out;
    }

    .sphere-icon-small {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        color: white;
        margin-right: 1rem;
        flex-shrink: 0;
    }

    .assessment-date {
        font-size: 0.9rem;
        color: #7f8c8d;
        font-weight: 500;
    }

    .empty-history {
        text-align: center;
        padding: 4rem 2rem;
        background: white;
        border-radius: 16px;
        box-shadow: 0 8px 30px rgba(0,0,0,0.05);
    }

    .empty-icon {
        font-size: 4rem;
        color: #bdc3c7;
        margin-bottom: 1.5rem;
    }

    .stats-card {
        background: linear-gradient(135deg, rgba(56, 178, 172, 0.1) 0%, rgba(56, 178, 172, 0.05) 100%);
        border-radius: 12px;
        padding: 1.5rem;
        margin-top: 2rem;
        border: 1px solid rgba(56, 178, 172, 0.2);
    }

    .stat-item {
        text-align: center;
        padding: 1rem;
    }

    .stat-value {
        font-family: 'Montserrat', sans-serif;
        font-weight: 700;
        font-size: 2rem;
        color: var(--success);
        margin-bottom: 0.5rem;
    }

    .stat-label {
        font-size: 0.9rem;
        color: #7f8c8d;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
</style>
{% endblock %}

{% block content %}
<div class="history-container fade-in">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="history-header">
        <div class="d-flex align-items-center mb-3">
            <div class="me-3">
                <i class="bi bi-bar-chart-fill" style="font-size: 2.5rem; color: var(--primary);"></i>
            </div>
            <div>
                <h1 class="display-6 fw-bold mb-2" style="color: var(--primary);">üìä –ò—Å—Ç–æ—Ä–∏—è –≤–∞—à–∏—Ö –æ—Ü–µ–Ω–æ–∫</h1>
                <p class="lead mb-0 text-muted">
                    –≠—Ç–æ –≤–∞—à –ª–∏—á–Ω—ã–π —Ç—Ä–µ–∫–µ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞. –ó–¥–µ—Å—å –≤—ã –≤–∏–¥–∏—Ç–µ –≤—Å–µ –æ—Ü–µ–Ω–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–∞–≤–∏–ª–∏ —Å–≤–æ–∏–º –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Å—Ñ–µ—Ä–∞–º.
                    –ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –¥–∏–Ω–∞–º–∏–∫–æ–π –∏ –æ—Ç–º–µ—á–∞–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.
                </p>
            </div>
        </div>
    </div>

    {% if assessments %}
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-card">
            <div class="row text-center">
                <div class="col-md-4">
                    <div class="stat-item">
                        <div class="stat-value">{{ assessments|length }}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –æ—Ü–µ–Ω–æ–∫</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-item">
                        {% with last_week_count=assessments|slice:":7"|length %}
                        <div class="stat-value">{{ last_week_count }}</div>
                        {% endwith %}
                        <div class="stat-label">–ó–∞ –Ω–µ–¥–µ–ª—é</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-item">
                        <div class="stat-value">{{ average_score }}</div>
                        <div class="stat-label">–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –æ—Ü–µ–Ω–æ–∫ -->
        <div class="mt-4">
            <h3 class="mb-4" style="color: var(--primary);">
                <i class="bi bi-list-check me-2"></i>–í—Å–µ –æ—Ü–µ–Ω–∫–∏
            </h3>

            {% for assessment in assessments %}
            <div class="assessment-card">
                <div class="row align-items-center">
                    <!-- –ë–∞–ª–ª -->
                    <div class="col-md-2">
                        <div class="d-flex flex-column align-items-center">
                            <div class="assessment-score">
                                {{ assessment.value }}
                            </div>
                            <div class="score-indicator">
                                <div class="score-fill" style="width: {% widthratio assessment.value 10 100 %}%;
                                    background:
                                    {% if assessment.value <= 3 %}
                                        linear-gradient(90deg, #e74c3c, #e67e22)
                                    {% elif assessment.value <= 5 %}
                                        linear-gradient(90deg, #e67e22, #f1c40f)
                                    {% elif assessment.value <= 7 %}
                                        linear-gradient(90deg, #2ecc71, #27ae60)
                                    {% else %}
                                        linear-gradient(90deg, #3498db, #2c3e50)
                                    {% endif %};">
                                </div>
                            </div>
                            <small class="text-muted mt-1">–∏–∑ 10</small>
                        </div>
                    </div>

                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                    <div class="col-md-10">
                        <div class="d-flex align-items-center">
                            <!-- –ò–∫–æ–Ω–∫–∞ —Å—Ñ–µ—Ä—ã -->
                            <div class="sphere-icon-small" style="background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);">
                                {% if assessment.sphere.title == "–ó–¥–æ—Ä–æ–≤—å–µ" %}
                                    <i class="bi bi-heart-pulse"></i>
                                {% elif assessment.sphere.title == "–§–∏–Ω–∞–Ω—Å—ã" %}
                                    <i class="bi bi-cash-stack"></i>
                                {% elif assessment.sphere.title == "–ö–∞—Ä—å–µ—Ä–∞" %}
                                    <i class="bi bi-briefcase"></i>
                                {% elif assessment.sphere.title == "–û—Ç–Ω–æ—à–µ–Ω–∏—è" %}
                                    <i class="bi bi-people"></i>
                                {% elif assessment.sphere.title == "–°–µ–º—å—è" %}
                                    <i class="bi bi-house-heart"></i>
                                {% elif assessment.sphere.title == "–õ–∏—á–Ω–æ—Å—Ç–Ω—ã–π —Ä–æ—Å—Ç" %}
                                    <i class="bi bi-lightbulb"></i>
                                {% elif assessment.sphere.title == "–î—É—Ö–æ–≤–Ω–æ—Å—Ç—å" %}
                                    <i class="bi bi-flower1"></i>
                                {% elif assessment.sphere.title == "–û—Ç–¥—ã—Ö –∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è" %}
                                    <i class="bi bi-emoji-smile"></i>
                                {% else %}
                                    <i class="bi bi-circle"></i>
                                {% endif %}
                            </div>

                            <!-- –î–µ—Ç–∞–ª–∏ -->
                            <div class="flex-grow-1">
                                <h5 class="mb-1" style="color: var(--primary);">{{ assessment.sphere.title }}</h5>
                                <div class="assessment-date">
                                    <i class="bi bi-calendar me-1"></i>{{ assessment.date|date:"d E Y" }}
                                </div>
                                {% if assessment.comment %}
                                <p class="mb-0 mt-2 small text-muted">
                                    <i class="bi bi-chat-left-text me-1"></i>{{ assessment.comment }}
                                </p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –±–µ–∑ –æ—Ü–µ–Ω–æ–∫ -->
        <div class="empty-history">
            <div class="empty-icon">
                <i class="bi bi-bar-chart"></i>
            </div>
            <h3 class="mb-3" style="color: var(--primary);">–ò—Å—Ç–æ—Ä–∏—è –æ—Ü–µ–Ω–æ–∫ –ø—É—Å—Ç–∞</h3>
            <p class="text-muted mb-4" style="max-width: 500px; margin: 0 auto;">
                –í—ã –µ—â—ë –Ω–µ –æ—Ü–µ–Ω–∏–≤–∞–ª–∏ —Å–≤–æ–∏ —Å—Ñ–µ—Ä—ã –∂–∏–∑–Ω–∏. –ù–∞—á–Ω–∏—Ç–µ —Å –æ—Ü–µ–Ω–∫–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–π —Å—Ñ–µ—Ä—ã,
                —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –≤–∏–¥–µ—Ç—å –¥–∏–Ω–∞–º–∏–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏–π.
            </p>
            <a href="{% url 'sphere_list' %}" class="btn btn-primary btn-lg">
                <i class="bi bi-pie-chart me-2"></i>–ù–∞—á–∞—Ç—å –æ—Ü–µ–Ω–∫—É
            </a>
        </div>
    {% endif %}

    <!-- –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ -->
    <div class="text-center mt-5">
        <a href="{% url 'sphere_list' %}" class="btn btn-outline-primary">
            <i class="bi bi-arrow-left me-2"></i>–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –æ—Ü–µ–Ω–∫–µ —Å—Ñ–µ—Ä
        </a>
    </div>
</div>

<script>
// –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
    const scoreFills = document.querySelectorAll('.score-fill');
    scoreFills.forEach(fill => {
        const width = fill.style.width;
        fill.style.width = '0%';
        setTimeout(() => {
            fill.style.width = width;
        }, 300);
    });

    // –ü–æ–¥—Å—á–µ—Ç —Å—Ä–µ–¥–Ω–µ–π –æ—Ü–µ–Ω–∫–∏ (–Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    const assessments = {{ assessments|safe }};
    if (assessments && assessments.length > 0) {
        let sum = 0;
        assessments.forEach(a => {
            sum += a.value;
        });
        const avg = (sum / assessments.length).toFixed(1);
        // –ú–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç —Å–æ —Å—Ä–µ–¥–Ω–µ–π –æ—Ü–µ–Ω–∫–æ–π, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    }
});
</script>
{% endblock %}